{"version":3,"sources":["matter.min.js","/source/matter.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","global","factory","exports","module","require","define","amd","Matter","_","superagent","this","buildMessageArgs","logData","msgStr","msgObj","isObject","has","obj","func","file","each","omit","keys","ind","list","isString","msg","handleResponse","req","Promise","resolve","reject","end","err","res","status","logger","warn","body","addAuthHeader","token","string","set","info","message","config","serverUrl","tokenName","log","msgArgs","envName","console","apply","debug","error","data","storage","item","itemName","itemValue","setItem","localExists","window","sessionStorage","getItem","removeItem","description","clear","get","testKey","save","tokenStr","delete","request","endpoint","queryData","query","post","send","put","del","appName","opts","Error","name","options","value","signupData","then","response","account","errRes","loginData","_this","password","username","text","_this2","localServer","url","location","host","_this3","resove","responseData","currentUser"],"mappings":"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","file":"matter.min.js","sourcesContent":[null,"(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('lodash'), require('superagent')) :\n\ttypeof define === 'function' && define.amd ? define(['lodash', 'superagent'], factory) :\n\tglobal.Matter = factory(global._,global.superagent);\n}(this, function (_,superagent) { 'use strict';\n\n\t_ = 'default' in _ ? _['default'] : _;\n\tsuperagent = 'default' in superagent ? superagent['default'] : superagent;\n\n\tlet config = {\n\t\tserverUrl: 'http://tessellate.elasticbeanstalk.com',\n\t\ttokenName: 'tessellate'\n\t};\n\n\tlet logger = {\n\t\tlog(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.log(logData);\n\t\t\t} else {\n\t\t\t\tconsole.log.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\tinfo(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.info(logData);\n\t\t\t} else {\n\t\t\t\tconsole.info.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\twarn(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.warn(logData);\n\t\t\t} else {\n\t\t\t\tconsole.warn.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\tdebug(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.log(logData);\n\t\t\t} else {\n\t\t\t\tconsole.log.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\terror(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.error(logData);\n\t\t\t} else {\n\t\t\t\tconsole.error.apply(console, msgArgs);\n\t\t\t\t//TODO: Log to external logger\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction buildMessageArgs(logData) {\n\t\tvar msgStr = '';\n\t\tvar msgObj = {};\n\t\t//TODO: Attach time stamp\n\t\tif (_.isObject(logData)) {\n\t\t\tif (_.has(logData, 'func')) {\n\t\t\t\tif (_.has(logData, 'obj')) {\n\t\t\t\t\tmsgStr += '[' + logData.obj + '.' + logData.func + '()] ';\n\t\t\t\t} else if (_.has(logData, 'file')) {\n\t\t\t\t\tmsgStr += '[' + logData.file + ' > ' + logData.func + '()] ';\n\t\t\t\t} else {\n\t\t\t\t\tmsgStr += '[' + logData.func + '()] ';\n\t\t\t\t}\n\t\t\t}\n\t\t\t//Print each key and its value other than obj and func\n\t\t\t_.each(_.omit(_.keys(logData)), function(key, ind, list) {\n\t\t\t\tif (key != 'func' && key != 'obj') {\n\t\t\t\t\tif (key == 'description' || key == 'message') {\n\t\t\t\t\t\tmsgStr += logData[key];\n\t\t\t\t\t} else if (_.isString(logData[key])) {\n\t\t\t\t\t\t// msgStr += key + ': ' + logData[key] + ', ';\n\t\t\t\t\t\tmsgObj[key] = logData[key];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Print objects differently\n\t\t\t\t\t\t// msgStr += key + ': ' + logData[key] + ', ';\n\t\t\t\t\t\tmsgObj[key] = logData[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tmsgStr += '\\n';\n\t\t} else if (_.isString(logData)) {\n\t\t\tmsgStr = logData;\n\t\t}\n\t\tvar msg = [msgStr, msgObj];\n\n\t\treturn msg;\n\t}\n\n\tlet data = {};\n\t// TODO: Store objects within local storage.\n\tlet storage = {\n\t\tget localExists() {\n\t\t\tconst testKey = 'test';\n\t\t\tif (typeof window != 'undefined' && typeof window.sessionStorage != 'undefined') {\n\t\t\t\ttry {\n\t\t\t\t\twindow.sessionStorage.setItem(testKey, '1');\n\t\t\t\t\twindow.sessionStorage.removeItem(testKey);\n\t\t\t\t\treturn true;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.error({description: 'Error saving to session storage', error: err,  obj: 'storage', func: 'localExists'});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley sets item to session storage.\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t * @param {String} itemValue The items value\n\t\t *\n\t\t */\n\t\titem(itemName, itemValue) {\n\t\t\t//TODO: Handle itemValue being an object instead of a string\n\t\t\treturn this.setItem(itemName, itemValue);\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley sets item to session storage. Alias: item()\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t * @param {String} itemValue The items value\n\t\t *\n\t\t */\n\t\tsetItem(itemName, itemValue) {\n\t\t\t//TODO: Handle itemValue being an object instead of a string\n\t\t\t// this.item(itemName) = itemValue;\n\t\t\tdata[itemName] = itemValue;\n\t\t\tif (this.localExists) {\n\t\t\t\twindow.sessionStorage.setItem(itemName, itemValue);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * @description\n\t\t * Safley gets an item from session storage. Alias: item()\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t *\n\t\t * @return {String}\n\t\t *\n\t\t */\n\t\tgetItem(itemName) {\n\t\t\tif (data[itemName]) {\n\t\t\t\treturn data[itemName];\n\t\t\t} else if (this.localExists) {\n\t\t\t\treturn window.sessionStorage.getItem(itemName);\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName - The items name\n\t\t *\n\t\t */\n\t\tremoveItem(itemName) {\n\t\t\t//TODO: Only remove used items\n\t\t\tif (data[itemName]) {\n\t\t\t\tdata[itemName] = null;\n\t\t\t}\n\t\t\tif (this.localExists) {\n\t\t\t\ttry {\n\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.removeItem(itemName);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.error({description: 'Error removing item from session storage', error: err,  obj: 'storage', func: 'removeItem'});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName the items name\n\t\t * @param {String} itemValue the items value\n\t\t *\n\t\t */\n\t\tclear() {\n\t\t\t//TODO: Only remove used items\n\t\t\tdata = {};\n\t\t\tif (this.localExists) {\n\t\t\t\ttry {\n\t\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.clear();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.warn('Session storage could not be cleared.', err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t};\n\n\tlet token = {\n\t\tget string() {\n\t\t\treturn storage.getItem(config.tokenName);\n\t\t},\n\t\tget data() {\n\t\t\t//TODO: Decode token\n\t\t},\n\t\tset string(tokenStr) {\n\t\t\tlogger.log({description: 'Token was set.', token: tokenStr, func: 'string', obj: 'token'});\n\t\t\treturn storage.setItem(config.tokenName, tokenStr);\n\t\t},\n\t\tsave(tokenStr) {\n\t\t\tthis.string = tokenStr;\n\t\t\tstorage.setItem(config.tokenName, tokenStr);\n\t\t},\n\t\tdelete() {\n\t\t\tstorage.removeItem(config.tokenName);\n\t\t\tlogger.log({description: 'Token was removed.', func: 'delete', obj: 'token'});\n\t\t}\n\t};\n\n\tlet request = {\n\t\tget(endpoint, queryData) {\n\t\t\tvar req = superagent.get(endpoint);\n\t\t\tif (queryData) {\n\t\t\t\treq.query(queryData);\n\t\t\t}\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tpost(endpoint, data) {\n\t\t\tvar req = superagent.post(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tput(endpoint, data) {\n\t\t\tvar req = superagent.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tdel(endpoint, data) {\n\t\t\tvar req = superagent.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t}\n\n\t};\n\n\tfunction handleResponse(req) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treq.end((err, res) => {\n\t\t\t\tif (!err) {\n\t\t\t\t\t// logger.log({description: 'Response:', response:res, func:'handleResponse', file: 'request'});\n\t\t\t\t\treturn resolve(res.body);\n\t\t\t\t} else {\n\t\t\t\t\tif (err.status == 401) {\n\t\t\t\t\t\tlogger.warn('Unauthorized. You must be signed into make this request.');\n\t\t\t\t\t}\n\t\t\t\t\treturn reject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tfunction addAuthHeader(req) {\n\t\tif (token.string) {\n\t\t\treq = req.set('Authorization', 'Bearer ' + token.string);\n\t\t\tlogger.info({message: 'Set auth header', func: 'addAuthHeader', file: 'request'});\n\t\t}\n\t\treturn req;\n\t}\n\n\tlet user;\n\tlet endpoints;\n\n\tclass Matter {\n\t\t/* Constructor\n\t\t * @param {string} appName Name of application\n\t\t */\n\t\tconstructor(appName, opts) {\n\t\t\tif (!appName) {\n\t\t\t\tlogger.error({description: 'Application name requires to use Matter.', func: 'constructor', obj: 'Matter'});\n\t\t\t\tthrow new Error('Application name is required to use Matter');\n\t\t\t} else {\n\t\t\t\tthis.name = appName;\n\t\t\t}\n\t\t\tif (opts) {\n\t\t\t\tthis.options = opts;\n\t\t\t}\n\t\t}\n\t\t/* Endpoint getter\n\t\t *\n\t\t */\n\t\tget endpoint() {\n\t\t\tlet serverUrl = config.serverUrl;\n\t\t\tif (_.has(this, 'options') && this.options.localServer) {\n\t\t\t\tserverUrl = 'http://localhost:4000';\n\t\t\t\tlogger.info({description: 'LocalServer option was set to true. Now server url is local server.', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t}\n\t\t\tif (this.name == 'tessellate') {\n\t\t\t\t//Remove url if host is server\n\t\t\t\tif (window && _.has(window, 'location') && window.location.host == serverUrl) {\n\t\t\t\t\tserverUrl = '';\n\t\t\t\t\tlogger.info({description: 'Host is Server, serverUrl simplified!', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tserverUrl = config.serverUrl + '/apps/' + this.name;\n\t\t\t\tlogger.info({description: 'Server url set.', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t}\n\t\t\treturn serverUrl;\n\t\t}\n\t\t/* Signup\n\t\t *\n\t\t */\n\t\tsignup(signupData) {\n\t\t\treturn request.post(this.endpoint + '/signup', signupData)\n\t\t\t.then((response) => {\n\t\t\t\tlogger.log({description: 'Account request successful.', signupData: signupData, response: response, func: 'signup', obj: 'Matter'});\n\t\t\t\tif (_.has(response, 'account')) {\n\t\t\t\t\treturn response.account;\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn({description: 'Account was not contained in signup response.', signupData: signupData, response: response, func: 'signup', obj: 'Matter'});\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t})\n\t\t\t['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting signup.', signupData: signupData, error: errRes, func: 'signup', obj: 'Matter'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** Login\n\t\t *\n\t\t */\n\t\tlogin(loginData) {\n\t\t\tif (!loginData || !loginData.password || !loginData.username) {\n\t\t\t\tlogger.error({description: 'Username/Email and Password are required to login', func: 'login', obj: 'Matter'});\n\t\t\t\treturn Promise.reject({message: 'Username/Email and Password are required to login'});\n\t\t\t}\n\t\t\treturn request.put(this.endpoint + '/login', loginData)\n\t\t\t.then((response) => {\n\t\t\t\tif (_.has(response, 'data') && _.has(response.data, 'status') && response.data.status == 409) {\n\t\t\t\t\tlogger.warn({description: 'Account not found.', response: response, func: 'login', obj: 'Matter'});\n\t\t\t\t\treturn Promise.reject(response.data);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.log({description: 'Successful login.', response: response, func: 'login', obj: 'Matter'});\n\t\t\t\t\tif (_.has(response, 'token')) {\n\t\t\t\t\t\tthis.token.string = response.token;\n\t\t\t\t\t}\n\t\t\t\t\tif (_.has(response, 'account')) {\n\t\t\t\t\t\tthis.storage.setItem('currentUser');\n\t\t\t\t\t}\n\t\t\t\t\treturn response.account;\n\t\t\t\t}\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting login.', error: errRes, status: errRes.status,  func: 'login', obj: 'Matter'});\n\t\t\t\tif (errRes.status == 409 || errRes.status == 400) {\n\t\t\t\t\terrRes = errRes.response.text;\n\t\t\t\t}\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** Logout\n\t\t */\n\t\tlogout() {\n\t\t\treturn request.put(this.endpoint + '/logout').then((response) => {\n\t\t\t\tlogger.log({description: 'Logout successful.', response: response, func: 'logout', obj: 'Matter'});\n\t\t\t\tthis.storage.removeItem('currentUser');\n\t\t\t\tthis.token.delete();\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting log out: ', error: errRes, func: 'logout', obj: 'Matter'});\n\t\t\t\tthis.storage.removeItem('currentUser');\n\t\t\t\tthis.token.delete();\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\tget currentUser() {\n\t\t\tif (this.storage.item('currentUser')) {\n\t\t\t\t//TODO: Check to see if this comes back as a string\n\t\t\t\treturn Promise.resove(this.storage.item('currentUser'));\n\t\t\t} else {\n\t\t\t\treturn request.get(this.endpoint + '/user').then((response) => {\n\t\t\t\t\t//TODO: Save user information locally\n\t\t\t\t\tlogger.log({description: 'Current User Request responded.', responseData: response.data, func: 'currentUser', obj: 'Matter'});\n\t\t\t\t\tthis.currentUser = response.data;\n\t\t\t\t\treturn response.data;\n\t\t\t\t})['catch']((errRes) => {\n\t\t\t\t\tlogger.error({description: 'Error requesting current user.', error: errRes, func: 'currentUser', obj: 'Matter'});\n\t\t\t\t\treturn Promise.reject(errRes);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tget storage() {\n\t\t\treturn storage;\n\t\t}\n\t\tget token() {\n\t\t\treturn token;\n\t\t}\n\t\tget isLoggedIn() {\n\t\t\treturn this.token.string ? true : false;\n\t\t}\n\t};\n\n\treturn Matter;\n\n}));"],"sourceRoot":"/source/"}