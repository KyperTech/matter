{"version":3,"sources":["matter.min.js","/source/matter.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","global","factory","exports","module","require","define","amd","Matter","_","jwtDecode","superagent","this","buildMessageArgs","logData","msgStr","msgObj","isObject","has","obj","func","file","each","omit","keys","ind","list","isString","msg","decodeToken","tokenStr","tokenData","undefined","err","logger","error","description","data","Error","handleResponse","req","Promise","resolve","reject","end","res","status","warn","body","addAuthHeader","token","string","set","info","message","config","serverUrl","tokenName","tokenDataName","window","location","hostname","log","msgArgs","envName","console","apply","debug","storage","item","itemName","itemValue","setItem","localExists","JSON","stringify","sessionStorage","getItem","itemStr","isObj","itemObj","parse","removeItem","clear","get","testKey","save","delete","request","endpoint","queryData","query","post","send","put","del","appName","opts","name","options","value","signupData","then","response","account","errRes","loginData","_this","password","username","text","_this2","updateData","_this3","isLoggedIn","responseData","currentUser","localServer","url","host","_this4","resove"],"mappings":"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","file":"matter.min.js","sourcesContent":[null,"(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('lodash'), require('jwt-decode'), require('superagent')) :\n\ttypeof define === 'function' && define.amd ? define(['lodash', 'jwt-decode', 'superagent'], factory) :\n\tglobal.Matter = factory(global._,global.jwtDecode,global.superagent);\n}(this, function (_,jwtDecode,superagent) { 'use strict';\n\n\t_ = 'default' in _ ? _['default'] : _;\n\tjwtDecode = 'default' in jwtDecode ? jwtDecode['default'] : jwtDecode;\n\tsuperagent = 'default' in superagent ? superagent['default'] : superagent;\n\n\tlet config = {\n\t\tserverUrl: 'http://tessellate.elasticbeanstalk.com',\n\t\ttokenName: 'tessellate',\n\t\ttokenDataName: 'tessellate-tokenData'\n\t};\n\t//Set server to local server if developing\n\tif (typeof window != 'undefined' && (window.location.hostname == '' || window.location.hostname == 'localhost')) {\n\t\tconfig.serverUrl = 'http://localhost:4000';\n\t}\n\n\tlet logger = {\n\t\tlog(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.log(logData);\n\t\t\t} else {\n\t\t\t\tconsole.log.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\tinfo(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.info(logData);\n\t\t\t} else {\n\t\t\t\tconsole.info.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\twarn(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.warn(logData);\n\t\t\t} else {\n\t\t\t\tconsole.warn.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\tdebug(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.log(logData);\n\t\t\t} else {\n\t\t\t\tconsole.log.apply(console, msgArgs);\n\t\t\t}\n\t\t},\n\t\terror(logData) {\n\t\t\tlet msgArgs = buildMessageArgs(logData);\n\t\t\tif (config.envName == 'local') {\n\t\t\t\tconsole.error(logData);\n\t\t\t} else {\n\t\t\t\tconsole.error.apply(console, msgArgs);\n\t\t\t\t//TODO: Log to external logger\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction buildMessageArgs(logData) {\n\t\tvar msgStr = '';\n\t\tvar msgObj = {};\n\t\t//TODO: Attach time stamp\n\t\tif (_.isObject(logData)) {\n\t\t\tif (_.has(logData, 'func')) {\n\t\t\t\tif (_.has(logData, 'obj')) {\n\t\t\t\t\tmsgStr += '[' + logData.obj + '.' + logData.func + '()] ';\n\t\t\t\t} else if (_.has(logData, 'file')) {\n\t\t\t\t\tmsgStr += '[' + logData.file + ' > ' + logData.func + '()] ';\n\t\t\t\t} else {\n\t\t\t\t\tmsgStr += '[' + logData.func + '()] ';\n\t\t\t\t}\n\t\t\t}\n\t\t\t//Print each key and its value other than obj and func\n\t\t\t_.each(_.omit(_.keys(logData)), function(key, ind, list) {\n\t\t\t\tif (key != 'func' && key != 'obj') {\n\t\t\t\t\tif (key == 'description' || key == 'message') {\n\t\t\t\t\t\tmsgStr += logData[key];\n\t\t\t\t\t} else if (_.isString(logData[key])) {\n\t\t\t\t\t\t// msgStr += key + ': ' + logData[key] + ', ';\n\t\t\t\t\t\tmsgObj[key] = logData[key];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Print objects differently\n\t\t\t\t\t\t// msgStr += key + ': ' + logData[key] + ', ';\n\t\t\t\t\t\tmsgObj[key] = logData[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tmsgStr += '\\n';\n\t\t} else if (_.isString(logData)) {\n\t\t\tmsgStr = logData;\n\t\t}\n\t\tvar msg = [msgStr, msgObj];\n\n\t\treturn msg;\n\t}\n\n\tlet data = {};\n\tlet storage = {\n\t\tget localExists() {\n\t\t\tconst testKey = 'test';\n\t\t\tif (typeof window != 'undefined' && typeof window.sessionStorage != 'undefined') {\n\t\t\t\ttry {\n\t\t\t\t\twindow.sessionStorage.setItem(testKey, '1');\n\t\t\t\t\twindow.sessionStorage.removeItem(testKey);\n\t\t\t\t\treturn true;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.error({description: 'Error saving to session storage', error: err,  obj: 'storage', func: 'localExists'});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley sets item to session storage.\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t * @param {String} itemValue The items value\n\t\t *\n\t\t */\n\t\titem(itemName, itemValue) {\n\t\t\treturn this.setItem(itemName, itemValue);\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley sets item to session storage. Alias: item()\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t * @param {String} itemValue The items value\n\t\t *\n\t\t */\n\t\tsetItem(itemName, itemValue) {\n\t\t\tdata[itemName] = itemValue;\n\t\t\tif (this.localExists) {\n\t\t\t\t//Convert object to string\n\t\t\t\tif (_.isObject(itemValue)) {\n\t\t\t\t\titemValue = JSON.stringify(itemValue);\n\t\t\t\t}\n\t\t\t\twindow.sessionStorage.setItem(itemName, itemValue);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * @description\n\t\t * Safley gets an item from session storage. Alias: item()\n\t\t *\n\t\t * @param {String} itemName The items name\n\t\t *\n\t\t * @return {String}\n\t\t *\n\t\t */\n\t\tgetItem(itemName) {\n\t\t\tif (data[itemName]) {\n\t\t\t\treturn data[itemName];\n\t\t\t} else if (this.localExists) {\n\t\t\t\tlet itemStr = window.sessionStorage.getItem(itemName);\n\t\t\t\t//Check that str is not null before parsing\n\t\t\t\tif (itemStr) {\n\t\t\t\t\tlet isObj = false;\n\t\t\t\t\tlet itemObj = null;\n\t\t\t\t\t//Try parsing to object\n\t\t\t\t\ttry {\n\t\t\t\t\t\titemObj = JSON.parse(itemStr);\n\t\t\t\t\t\tisObj = true;\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t// logger.log({message: 'String could not be parsed.', error: err, func: 'getItem', obj: 'storage'});\n\t\t\t\t\t\t//Parsing failed, this must just be a string\n\t\t\t\t\t\tisObj = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (isObj) {\n\t\t\t\t\t\treturn itemObj;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn itemStr;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName - The items name\n\t\t *\n\t\t */\n\t\tremoveItem(itemName) {\n\t\t\t//TODO: Only remove used items\n\t\t\tif (data[itemName]) {\n\t\t\t\tdata[itemName] = null;\n\t\t\t}\n\t\t\tif (this.localExists) {\n\t\t\t\ttry {\n\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.removeItem(itemName);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.error({description: 'Error removing item from session storage', error: err,  obj: 'storage', func: 'removeItem'});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @description\n\t\t * Safley removes item from session storage.\n\t\t *\n\t\t * @param {String} itemName the items name\n\t\t * @param {String} itemValue the items value\n\t\t *\n\t\t */\n\t\tclear() {\n\t\t\t//TODO: Only remove used items\n\t\t\tdata = {};\n\t\t\tif (this.localExists) {\n\t\t\t\ttry {\n\t\t\t\t\t\t//Clear session storage\n\t\t\t\t\twindow.sessionStorage.clear();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tlogger.warn('Session storage could not be cleared.', err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t};\n\n\tfunction decodeToken(tokenStr) {\n\t\tlet tokenData;\n\t\tif (tokenStr && tokenStr != '') {\n\t\t\ttry {\n\t\t\t\ttokenData = jwtDecode(tokenStr);\n\t\t\t} catch (err) {\n\t\t\t\tlogger.error({description: 'Error decoding token.', data: tokenData, error: err, func: 'decodeToken', file: 'token'});\n\t\t\t\tthrow new Error('Invalid token string.');\n\t\t\t}\n\t\t}\n\t\treturn tokenData;\n\t}\n\tlet token = {\n\t\tget string() {\n\t\t\treturn storage.getItem(config.tokenName);\n\t\t},\n\t\tget data() {\n\t\t\tif (storage.getItem(config.tokenDataName)) {\n\t\t\t\treturn storage.getItem(config.tokenDataName);\n\t\t\t} else {\n\t\t\t\treturn decodeToken(this.string);\n\t\t\t}\n\t\t},\n\t\tset data(tokenData) {\n\t\t\tif (_.isString(tokenData)) {\n\t\t\t\tlet tokenStr = tokenData;\n\t\t\t\ttokenData = decodeToken(tokenStr);\n\t\t\t\tlogger.info({description: 'Token data was set as string. Decoding token.', token: tokenStr, tokenData: tokenData, func: 'data', obj: 'token'});\n\t\t\t} else {\n\t\t\t\tlogger.log({description: 'Token data was set.', data: tokenData, func: 'data', obj: 'token'});\n\t\t\t\tstorage.setItem(config.tokenDataName, tokenData);\n\t\t\t}\n\t\t},\n\t\tset string(tokenStr) {\n\t\t\tlogger.log({description: 'Token was set.', token: tokenStr, func: 'string', obj: 'token'});\n\t\t\tthis.data = jwtDecode(tokenStr);\n\t\t\tstorage.setItem(config.tokenName, tokenStr);\n\t\t},\n\t\tsave(tokenStr) {\n\t\t\tthis.string = tokenStr;\n\t\t},\n\t\tdelete() {\n\t\t\tstorage.removeItem(config.tokenName);\n\t\t\tstorage.removeItem(config.tokenDataName);\n\t\t\tlogger.log({description: 'Token was removed.', func: 'delete', obj: 'token'});\n\t\t}\n\t};\n\n\tlet request = {\n\t\tget(endpoint, queryData) {\n\t\t\tvar req = superagent.get(endpoint);\n\t\t\tif (queryData) {\n\t\t\t\treq.query(queryData);\n\t\t\t}\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tpost(endpoint, data) {\n\t\t\tvar req = superagent.post(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tput(endpoint, data) {\n\t\t\tvar req = superagent.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t},\n\t\tdel(endpoint, data) {\n\t\t\tvar req = superagent.put(endpoint).send(data);\n\t\t\treq = addAuthHeader(req);\n\t\t\treturn handleResponse(req);\n\t\t}\n\t};\n\n\tfunction handleResponse(req) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treq.end((err, res) => {\n\t\t\t\tif (!err) {\n\t\t\t\t\t// logger.log({description: 'Response:', response:res, func:'handleResponse', file: 'request'});\n\t\t\t\t\treturn resolve(res.body);\n\t\t\t\t} else {\n\t\t\t\t\tif (err.status == 401) {\n\t\t\t\t\t\tlogger.warn('Unauthorized. You must be signed into make this request.');\n\t\t\t\t\t}\n\t\t\t\t\treturn reject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tfunction addAuthHeader(req) {\n\t\tif (token.string) {\n\t\t\treq = req.set('Authorization', 'Bearer ' + token.string);\n\t\t\tlogger.info({message: 'Set auth header', func: 'addAuthHeader', file: 'request'});\n\t\t}\n\t\treturn req;\n\t}\n\n\tlet user;\n\tlet endpoints;\n\n\tclass Matter {\n\t\t/* Constructor\n\t\t * @param {string} appName Name of application\n\t\t */\n\t\tconstructor(appName, opts) {\n\t\t\tif (!appName) {\n\t\t\t\tlogger.error({description: 'Application name requires to use Matter.', func: 'constructor', obj: 'Matter'});\n\t\t\t\tthrow new Error('Application name is required to use Matter');\n\t\t\t} else {\n\t\t\t\tthis.name = appName;\n\t\t\t}\n\t\t\tif (opts) {\n\t\t\t\tthis.options = opts;\n\t\t\t}\n\t\t}\n\t\t/* Endpoint getter\n\t\t *\n\t\t */\n\t\tget endpoint() {\n\t\t\tlet serverUrl = config.serverUrl;\n\t\t\tif (_.has(this, 'options') && this.options.localServer) {\n\t\t\t\tserverUrl = 'http://localhost:4000';\n\t\t\t\tlogger.info({description: 'LocalServer option was set to true. Now server url is local server.', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t}\n\t\t\tif (this.name == 'tessellate') {\n\t\t\t\t//Remove url if host is server\n\t\t\t\tif (window && _.has(window, 'location') && window.location.host == serverUrl) {\n\t\t\t\t\tserverUrl = '';\n\t\t\t\t\tlogger.info({description: 'Host is Server, serverUrl simplified!', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tserverUrl = config.serverUrl + '/apps/' + this.name;\n\t\t\t\tlogger.info({description: 'Server url set.', url: serverUrl, func: 'endpoint', obj: 'Matter'});\n\t\t\t}\n\t\t\treturn serverUrl;\n\t\t}\n\t\t/* Signup\n\t\t *\n\t\t */\n\t\tsignup(signupData) {\n\t\t\treturn request.post(this.endpoint + '/signup', signupData)\n\t\t\t.then((response) => {\n\t\t\t\tlogger.log({description: 'Account request successful.', signupData: signupData, response: response, func: 'signup', obj: 'Matter'});\n\t\t\t\tif (_.has(response, 'account')) {\n\t\t\t\t\treturn response.account;\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn({description: 'Account was not contained in signup response.', signupData: signupData, response: response, func: 'signup', obj: 'Matter'});\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t})\n\t\t\t['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting signup.', signupData: signupData, error: errRes, func: 'signup', obj: 'Matter'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** Login\n\t\t *\n\t\t */\n\t\tlogin(loginData) {\n\t\t\tif (!loginData || !loginData.password || !loginData.username) {\n\t\t\t\tlogger.error({description: 'Username/Email and Password are required to login', func: 'login', obj: 'Matter'});\n\t\t\t\treturn Promise.reject({message: 'Username/Email and Password are required to login'});\n\t\t\t}\n\t\t\treturn request.put(this.endpoint + '/login', loginData)\n\t\t\t.then((response) => {\n\t\t\t\tif (_.has(response, 'data') && _.has(response.data, 'status') && response.data.status == 409) {\n\t\t\t\t\tlogger.warn({description: 'Account not found.', response: response, func: 'login', obj: 'Matter'});\n\t\t\t\t\treturn Promise.reject(response.data);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.log({description: 'Successful login.', response: response, func: 'login', obj: 'Matter'});\n\t\t\t\t\tif (_.has(response, 'token')) {\n\t\t\t\t\t\tthis.token.string = response.token;\n\t\t\t\t\t}\n\t\t\t\t\tif (_.has(response, 'account')) {\n\t\t\t\t\t\tthis.storage.setItem('currentUser', response.account);\n\t\t\t\t\t}\n\t\t\t\t\treturn response.account;\n\t\t\t\t}\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting login.', error: errRes, status: errRes.status,  func: 'login', obj: 'Matter'});\n\t\t\t\tif (errRes.status == 409 || errRes.status == 400) {\n\t\t\t\t\terrRes = errRes.response.text;\n\t\t\t\t}\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** Logout\n\t\t */\n\t\tlogout() {\n\t\t\treturn request.put(this.endpoint + '/logout').then((response) => {\n\t\t\t\tlogger.log({description: 'Logout successful.', response: response, func: 'logout', obj: 'Matter'});\n\t\t\t\tthis.storage.removeItem('currentUser');\n\t\t\t\tthis.token.delete();\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting log out: ', error: errRes, func: 'logout', obj: 'Matter'});\n\t\t\t\tthis.storage.removeItem('currentUser');\n\t\t\t\tthis.token.delete();\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** currentUser\n\t\t */\n\t\tget currentUser() {\n\t\t\tif (this.storage.item('currentUser')) {\n\t\t\t\treturn Promise.resove(this.storage.item('currentUser'));\n\t\t\t} else {\n\t\t\t\treturn request.get(this.endpoint + '/user').then((response) => {\n\t\t\t\t\t//TODO: Save user information locally\n\t\t\t\t\tlogger.log({description: 'Current User Request responded.', responseData: response.data, func: 'currentUser', obj: 'Matter'});\n\t\t\t\t\tthis.currentUser = response.data;\n\t\t\t\t\treturn response.data;\n\t\t\t\t})['catch']((errRes) => {\n\t\t\t\t\tlogger.error({description: 'Error requesting current user.', error: errRes, func: 'currentUser', obj: 'Matter'});\n\t\t\t\t\treturn Promise.reject(errRes);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tupdateProfile(updateData) {\n\t\t\tif (!this.isLoggedIn) {\n\t\t\t\tlogger.error({description: 'No current user profile to update.', func: 'updateProfile', obj: 'Matter'});\n\t\t\t\treturn Promise.reject({message: 'Must be logged in to update profile.'});\n\t\t\t}\n\t\t\t//Send update request\n\t\t\tlogger.warn({description: 'Calling update endpoint.', endpoint: `${this.endpoint}/user/${this.token.data.username}` , func: 'updateProfile', obj: 'Matter'});\n\t\t\treturn request.put(`${this.endpoint}/user/${this.token.data.username}` , updateData).then((response) => {\n\t\t\t\tlogger.log({description: 'Update profile request responded.', responseData: response, func: 'updateProfile', obj: 'Matter'});\n\t\t\t\tthis.currentUser = response;\n\t\t\t\treturn response;\n\t\t\t})['catch']((errRes) => {\n\t\t\t\tlogger.error({description: 'Error requesting current user.', error: errRes, func: 'updateProfile', obj: 'Matter'});\n\t\t\t\treturn Promise.reject(errRes);\n\t\t\t});\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tget storage() {\n\t\t\treturn storage;\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tget token() {\n\t\t\treturn token;\n\t\t}\n\t\t/** updateProfile\n\t\t */\n\t\tget isLoggedIn() {\n\t\t\treturn this.token.string ? true : false;\n\t\t}\n\t\t/** utils\n\t\t */\n\t\tget utils() {\n\t\t\treturn {request: request, logger: logger, storage: storage};\n\t\t}\n\t};\n\n\treturn Matter;\n\n}));"],"sourceRoot":"/source/"}